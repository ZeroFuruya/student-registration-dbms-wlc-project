<!DOCTYPE html>
<html>
<head>
  <title>DEVELOPING.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/recharts/DEVELOPING.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#setup-development-environment">Setup development environment</a>
      </div>

      <div class="heading h1">
        <a href="#linting-and-types">Linting and types</a>
      </div>

      <div class="heading h1">
        <a href="#automated-testing">Automated testing</a>
      </div>

      <div class="heading h2">
        <a href="#running-unit-tests">Running unit tests</a>
      </div>

      <div class="heading h2">
        <a href="#running-mutation-tests">Running mutation tests</a>
      </div>

      <div class="heading h2">
        <a href="#storybook">Storybook</a>
      </div>

      <div class="heading h2">
        <a href="#run-visual-regression-tests-using-playwright">Run visual regression tests (using playwright)</a>
      </div>

      <div class="heading h3">
        <a href="#prerequisites">Prerequisites</a>
      </div>

      <div class="heading h3">
        <a href="#build-the-docker-image">Build the Docker image</a>
      </div>

      <div class="heading h3">
        <a href="#run-the-tests">Run the tests</a>
      </div>

      <div class="heading h3">
        <a href="#see-vr-test-results">See VR test results</a>
      </div>

      <div class="heading h1">
        <a href="#manual-testing">Manual testing</a>
      </div>

      <div class="heading h2">
        <a href="#recharts.github.io-local-run">recharts.github.io local run</a>
      </div>

      <div class="heading h2">
        <a href="#storybook-1">Storybook</a>
      </div>

      <div class="heading h2">
        <a href="#playwright-ui-mode">Playwright UI mode</a>
      </div>

      <div class="heading h1">
        <a href="#releases">Releases</a>
      </div>

      <div class="heading h2">
        <a href="#release-testing">Release testing</a>
      </div>

      <div class="heading h1">
        <a href="#folder-structure">Folder structure</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><p>This is a development guide.
If you want to know the guidelines we follow then read <a href="CONTRIBUTING.md.html">CONTRIBUTING.md</a>.</p>
<div class="pilwrap" id="setup-development-environment">
  <h1>
    <a href="#setup-development-environment" name="setup-development-environment" class="pilcrow"></a>
Setup development environment
  </h1>
</div>
<pre><code class="sh">git <span class="hljs-built_in">clone</span> https://github.com/recharts/recharts.git
<span class="hljs-built_in">cd</span> recharts
npm install
</code></pre>
<div class="pilwrap" id="linting-and-types">
  <h1>
    <a href="#linting-and-types" name="linting-and-types" class="pilcrow"></a>
Linting and types
  </h1>
</div>
<p>You may also want to enable ESLint and Prettier configuration in your favourite IDE.</p>
<pre><code class="sh">$ npm run lint
$ npm run check-types
</code></pre>
<div class="pilwrap" id="automated-testing">
  <h1>
    <a href="#automated-testing" name="automated-testing" class="pilcrow"></a>
Automated testing
  </h1>
</div>
<div class="pilwrap" id="running-unit-tests">
  <h2>
    <a href="#running-unit-tests" name="running-unit-tests" class="pilcrow"></a>
Running unit tests
  </h2>
</div>
<p>Most unit tests are in the <code>test</code> directory, some others are in <code>www/test</code>.</p>
<p>Run all tests:</p>
<pre><code class="sh">$ npm run <span class="hljs-built_in">test</span>
</code></pre>
<p>Run a specific test file:</p>
<pre><code class="sh">$ npm run <span class="hljs-built_in">test</span> -- path/to/TestFile.spec.tsx
</code></pre>
<div class="pilwrap" id="running-mutation-tests">
  <h2>
    <a href="#running-mutation-tests" name="running-mutation-tests" class="pilcrow"></a>
Running mutation tests
  </h2>
</div>
<p>Mutation tests may take several hours to complete.
You may want to first open <code>./stryker.config.mjs</code> and set the <code>mutate</code> property to a specific file or directory
that you want to test. That may take 5-10 minutes to run.</p>
<p>Mutation tests do not run in CI.</p>
<pre><code class="sh">$ npm run <span class="hljs-built_in">test</span>-mutation
</code></pre>
<div class="pilwrap" id="storybook">
  <h2>
    <a href="#storybook" name="storybook" class="pilcrow"></a>
Storybook
  </h2>
</div>
<p>To run the Storybook UI:</p>
<pre><code class="sh">$ npm run storybook
</code></pre>
<p>and then browse to http://localhost:6006.</p>
<p>While the storybook is running:</p>
<pre><code class="sh">$ npm run <span class="hljs-built_in">test</span>-storybook
</code></pre>
<div class="pilwrap" id="run-visual-regression-tests-using-playwright">
  <h2>
    <a href="#run-visual-regression-tests-using-playwright" name="run-visual-regression-tests-using-playwright" class="pilcrow"></a>
Run visual regression tests (using playwright)
  </h2>
</div>
<div class="pilwrap" id="prerequisites">
  <h3>
    <a href="#prerequisites" name="prerequisites" class="pilcrow"></a>
Prerequisites
  </h3>
</div>
<p>Playwright tests are running inside Docker. You will need to have Docker installed and running.
See https://docs.docker.com/get-started/get-docker/. You do not need Docker account or login.</p>
<p>You only need to do this once.</p>
<div class="pilwrap" id="build-the-docker-image">
  <h3>
    <a href="#build-the-docker-image" name="build-the-docker-image" class="pilcrow"></a>
Build the Docker image
  </h3>
</div>
<p>This takes two or three minutes to complete.
You will need to re-build every time you make a change to dependencies in <code>package.json</code>.</p>
<pre><code class="sh">$ npm run <span class="hljs-built_in">test</span>-vr:prepare
</code></pre>
<div class="pilwrap" id="run-the-tests">
  <h3>
    <a href="#run-the-tests" name="run-the-tests" class="pilcrow"></a>
Run the tests
  </h3>
</div>
<p>Now, the usual loop. Write a new test, run it, fix it, repeat.</p>
<pre><code class="sh">$ npm run <span class="hljs-built_in">test</span>-vr
</code></pre>
<p>Alternatively, the UI playwright mode is available as well:</p>
<pre><code class="sh">$ npm run <span class="hljs-built_in">test</span>-vr:ui
</code></pre>
<p>If you want to record new snapshots or update the old ones, you can run:</p>
<pre><code class="sh">$ npm run <span class="hljs-built_in">test</span>-vr:update
</code></pre>
<p>You will see new files created in the <code>test-vr/__snapshots__</code> directory, please commit them to the repository!</p>
<div class="pilwrap" id="see-vr-test-results">
  <h3>
    <a href="#see-vr-test-results" name="see-vr-test-results" class="pilcrow"></a>
See VR test results
  </h3>
</div>
<p>Open http://localhost:9323 in your browser to see the results of the tests.
The CLI will tell you to run a &quot;show-report&quot; which is not necessary because there is already a Docker container running
in the background and serving the report. Just open the URL in your browser.</p>
<div class="pilwrap" id="manual-testing">
  <h1>
    <a href="#manual-testing" name="manual-testing" class="pilcrow"></a>
Manual testing
  </h1>
</div>
<div class="pilwrap" id="recharts.github.io-local-run">
  <h2>
    <a href="#recharts.github.io-local-run" name="recharts.github.io-local-run" class="pilcrow"></a>
recharts.github.io local run
  </h2>
</div>
<p>To manually test Recharts in a real application environment, you can use the <code>www</code> directory which contains the source code
for the Recharts documentation website https://recharts.github.io.</p>
<p>You can add a new example and commit it too!</p>
<p>To run the website locally in dev mode with hot-reloading:</p>
<pre><code class="sh">$ <span class="hljs-built_in">cd</span> www
$ npm run start
</code></pre>
<p>When running locally, the website pulls the Recharts library from the local filesystem.</p>
<p>When you make changes to the Recharts source code, you need to re-build it for the changes to be reflected in the website:</p>
<pre><code class="sh">$ <span class="hljs-built_in">cd</span> ..
$ npm run build
$ <span class="hljs-built_in">cd</span> www
</code></pre>
<p>In production build, the website pulls recharts from npm registry.</p>
<div class="pilwrap" id="storybook-1">
  <h2>
    <a href="#storybook-1" name="storybook-1" class="pilcrow"></a>
Storybook
  </h2>
</div>
<p>You can also use Storybook for manual testing of individual components.</p>
<pre><code class="sh">$ npm run storybook
</code></pre>
<p>When adding new stories, mind that all stories here are also used for automated visual regression tests,
using Chromatic cloud infrastructure.</p>
<p>Chromatic are very generous and free for open source projects,
however we already have so many stories that we hit the limit for open source plan in some months.</p>
<p>For this reason, try to keep storybook for high fidelity examples, the ones you want to see published on the website
and in storybook UI. For low fidelity tests, use unit tests or VR tests instead.</p>
<div class="pilwrap" id="playwright-ui-mode">
  <h2>
    <a href="#playwright-ui-mode" name="playwright-ui-mode" class="pilcrow"></a>
Playwright UI mode
  </h2>
</div>
<p>You can also use Playwright in UI mode for manual testing. This opens a browser window where you can see the tests running,
and you can see before &amp; after.</p>
<pre><code class="sh">$ npm run <span class="hljs-built_in">test</span>-vr:ui
</code></pre>
<div class="pilwrap" id="releases">
  <h1>
    <a href="#releases" name="releases" class="pilcrow"></a>
Releases
  </h1>
</div>
<p><a href="https://github.com/recharts/recharts/releases">Releases</a> are automated via GH Actions - when a new release is created
in GH, CI will trigger that:</p>
<ol>
<li>Runs a build</li>
<li>Runs tests</li>
<li>Runs <code>npm publish</code></li>
</ol>
<p>Version increments and tagging are not automated at this time.</p>
<div class="pilwrap" id="release-testing">
  <h2>
    <a href="#release-testing" name="release-testing" class="pilcrow"></a>
Release testing
  </h2>
</div>
<p>Until we can automate more, it should be preferred to test as close to the results of <code>npm publish</code> as we possibly can.
This ensures we don't publish unintended breaking changes. One way to do that is using <code>yalc</code> - <code>npm i -g yalc</code>.</p>
<ol>
<li>Make your changes in recharts</li>
<li><code>yalc publish</code> in recharts</li>
<li><code>yalc add recharts</code> in your test package (ex: in a vite or webpack reach app with recharts installed, imported, and
your recent changes used)</li>
<li><code>npm install</code></li>
<li>Test a local run, a build, etc.</li>
</ol>
<div class="pilwrap" id="folder-structure">
  <h1>
    <a href="#folder-structure" name="folder-structure" class="pilcrow"></a>
Folder structure
  </h1>
</div>
<p>Source code:</p>
<ul>
<li><code>src</code> - source code for Recharts library</li>
<li><code>test</code> - unit tests</li>
<li><code>test-vr</code> - visual regression tests (using Playwright)</li>
<li><code>www</code> - source code for Recharts documentation website recharts.github.io</li>
<li><code>storybook</code> - Storybook stories for Recharts components, and Storybook config+scaffolding</li>
<li><code>scripts</code> - helper scripts for development and releases</li>
<li><code>.husky</code> and <code>.github</code> - git hooks and GitHub Actions workflows for CI</li>
</ul>
<p>Autogenerated code:</p>
<p>Running <code>npm run build</code> generates the following folders:</p>
<ul>
<li><code>lib</code> - compiled output of Recharts library in CJS format - published to npm</li>
<li><code>es6</code> - compiled output of Recharts library in ESM format - published to npm</li>
<li><code>umd</code> - compiled output of Recharts library in UMD format - published to npm</li>
<li><code>types</code> - generated TypeScript declaration files - published to npm</li>
<li><code>build</code> - output of <code>tsc</code> build - we don't use this for anything at all I think</li>
</ul>
<p>Running <code>npm run test-coverage</code> generates:</p>
<ul>
<li><code>coverage</code> - code coverage report</li>
</ul>
<p>Running <code>npm run test-mutation</code> generates:</p>
<ul>
<li><code>reports</code> - mutation testing report</li>
</ul>
</div>
  </div>
</body>
</html>
